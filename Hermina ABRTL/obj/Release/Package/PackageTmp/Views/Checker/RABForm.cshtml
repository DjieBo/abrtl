@model Hermina_ABRTL.ViewModel.RABVM

<div class="hm-layout screen-page">
    <div class="hm-row hm-rab-layout">
        <div class="hm-row hm-nav-back hm-lh-back">
            <span class="backtoForm" id="RAB" onclick="Nav(this.id)"><i class="fas fa-chevron-left"></i> Back to previous page</span>
        </div>

        <div class="hm-row hm-rabform">
            <div class="hm-row hm-rab-head">
                <div class="hm-rab-col-3 hm-rab-head-style">Penilaian</div>
                <div class="hm-rab-col-4 hm-rab-head-style">Nilai</div>
                <div class="hm-rab-col-5 hm-rab-head-style">Keterangan</div>
                <div class="hm-rab-col-14 hm-rab-merge-style">
                    <div class="hm-row">Material</div>
                    <div class="hm-row hm-rab-snd-row">
                        <div class="hm-subcol">Kategori</div>
                        <div class="hm-subcol hm-subcol-mid-style">Item</div>
                        <div class="hm-subcol">Merk</div>
                    </div>
                </div>
                <div class="hm-rab-col-6 hm-rab-merge-style">Batasan<br>Biaya</div>
                <div class="hm-rab-col-7 hm-rab-head-style">Biaya</div>
                <div class="hm-rab-col-8 hm-rab-head-style">Selisih</div>
                <div class="hm-rab-col-9 hm-rab-merge-style">Picture<br>(Before)</div>
                <div class="hm-rab-col-9 hm-rab-head-style">Status</div>
            </div>
            <div class="hm-row hm-rab-body">
                @foreach (var item in Model.listSubmitRAB)
                {
                    var LgKom = item.Penilaian.Length;
                    var LgInfo = item.Keterangan.Length;
                    var Rnd = item.Round.Replace("Round ", "");

                    var node = " ..";
                    <div class="hm-rab-list">
                        <input type="hidden" name="dataID[]" id="HidID@(item.ID)@(Rnd)@(item.Periode)" value="@item.ID" />
                        <input type="hidden" name="dataRound[]" id="HidRD@(item.ID)@(Rnd)@(item.Periode)" value="@item.Round" />
                        <input type="hidden" name="dataPeriode[]" id="HidPR@(item.ID)@(Rnd)@(item.Periode)" value="@item.Periode" />
                        <div class="hm-rab-col-3 hm-rab-body-style hm-rab-font-style">
                            @if (LgKom < 25)
                            {
                                <div class="toltip">
                                    @item.Penilaian
                                    <span class="toltiptext">@item.SubArea / @item.Item / @item.Penilaian</span>
                                </div>
                            }
                            else if (LgKom >= 25)
                            {
                                var SbKom = item.Penilaian.Substring(0, 25);
                                <div class="toltip">
                                    @SbKom @node
                                    <span class="toltiptext">@item.SubArea / @item.Item / @item.Penilaian</span>
                                </div>

                            }
                        </div>
                        <div class="hm-rab-col-4 hm-rab-body-style hm-rab-alg-center hm-rab-font-style">@item.Nilai</div>
                        <div class="hm-rab-col-5 hm-rab-body-style hm-rab-font-style">
                            @if (LgInfo < 25){@item.Keterangan }
                            else if (LgInfo >= 25)
                            {var SbInfo = item.Keterangan.Substring(0, 25); @SbInfo @node}
                        </div>
                        <div class="hm-rab-col-15 hm-rab-sel-style">
                            @if (item.KomponenPerbaiki != null && item.KomponenPerbaiki != "")
                            {
                                <select id="Kat@(item.ID)@(Rnd)@(item.Periode)" name="kategori[]" disabled>
                                    <option value="@item.KomponenPerbaiki"> @item.KomponenPerbaiki</option>
                                </select>
                            }
                            else if (item.KomponenPerbaiki == null || item.KomponenPerbaiki == "")
                            {
                                <select id="Kat@(item.ID)@(Rnd)@(item.Periode)" onchange="KategoriRAB('@item.ID', '@Rnd', '@item.Periode')" name="kategori[]">
                                    <option></option>
                                    @foreach (var rab in Model.listSubmitRAB.GroupBy(s => s.LsKategoriBrg).Select(g => g.FirstOrDefault()).ToList())
                                    {
                                        foreach (var data in rab.LsKategoriBrg)
                                        {
                                            <option value="@data.IDKategori">@data.Kategori</option>
                                        }
                                    }
                                </select>
                            }
                        </div>
                        <div class="hm-rab-col-15 hm-rab-sel-style">
                            @if (item.ItemPerbaiki != null && item.ItemPerbaiki != "")
                            {
                                <select id="Slc@(item.ID)@(Rnd)@(item.Periode)" name="item[]" disabled>
                                    <option id="@item.ItemPerbaiki">@item.ItemPerbaiki</option>
                                </select>
                            }
                            else
                            {
                                <span id="Item@(item.ID)@(Rnd)@(item.Periode)"></span>
                                <select id="Slc@(item.ID)@(Rnd)@(item.Periode)" name="item[]" disabled>
                                    <option></option>
                                </select>
                            }
                        </div>

                        <div class="hm-rab-col-15 hm-rab-sel-style">
                            @if (item.DeskripsiPerbaiki != null && item.DeskripsiPerbaiki != "")
                            {
                                <span id="Dec@(item.ID)@(Rnd)@(item.Periode)"></span>
                                <select id="DescSlc@(item.ID)@(Rnd)@(item.Periode)" name="merk[]" disabled><option id="@item.DeskripsiPerbaiki">@item.DeskripsiPerbaiki</option></select>
                            }
                            else
                            {
                                <span id="Dec@(item.ID)@(Rnd)@(item.Periode)"></span>
                                <select id="DescSlc@(item.ID)@(Rnd)@(item.Periode)" name="merk[]" disabled><option></option></select>
                            }

                        </div>
                        <div class="hm-rab-col-6 hm-rab-input-style hm-rab-alg-right">
                            @if (item.HargaDasar != null && item.HargaDasar != "")
                            {
                                <input type="text" name="budget[]" id="budget@(item.ID)@(Rnd)@(item.Periode)" value="@item.HargaDasar" disabled />
                            }
                            else
                            { <input type="text" name="budget[]" id="budget@(item.ID)@(Rnd)@(item.Periode)" value="" disabled />}
                        </div>
                        <div class="hm-rab-col-7 hm-rab-input-style" id="pyt2">
                            @if (item.HargaInput != null && item.HargaInput != "")
                            {<input type="text" name="payout[]" id="pyout@(item.ID)@(Rnd)@(item.Periode)" oninput="MathPay(this.id)" value="@item.HargaInput" disabled />}
                            else
                            { <input type="text" name="payout[]" id="pyout@(item.ID)@(Rnd)@(item.Periode)" oninput="MathPay(this.id)" value="" autocomplete="off" placeholder="Input here" disabled />}
                        </div>
                        <div class="hm-rab-col-8 hm-rab-input-style hm-rab-alg-right" id="qrl2">
                            @if (item.SelisihHarga != null && item.SelisihHarga != "")
                            {<input type="text" name="quareel[]" value="@item.SelisihHarga" id="QAl@(item.ID)@(Rnd)@(item.Periode)" disabled> }
                            else
                            { <input type="text" name="quareel[]" placeholder="Auto here" value="@item.SelisihHarga" id="QAl@(item.ID)@(Rnd)@(item.Periode)" disabled>}
                        </div>
                        <div class="hm-rab-col-9 hm-rab-symbol-style hm-rab-alg-center"><a href="@Url.Action("BRABImage", "Checker", new { ID = item.ID, Round = item.Round, Periode = item.Periode})" target="_blank"><i class="fas fa-image"></i></a></div>
                        <div class="hm-rab-col-9 hm-rab-symbol-style hm-rab-alg-center hm-rab-status-yellow hm-rab-status-fnl" data-status="Waiting" id="Status@(item.ID)@(Rnd)@(item.Periode)"> Waitting </div>
                        <script>
                            $(document).ready(function () {
                                let Kategori = document.getElementById("Kat@(item.ID)@(Rnd)@(item.Periode)").value;
                                let Descrip = document.getElementById("Dec@(item.ID)@(Rnd)@(item.Periode)").value;
                                let Budged = document.getElementById("budget@(item.ID)@(Rnd)@(item.Periode)").value;
                                let Payout = document.getElementById("pyout@(item.ID)@(Rnd)@(item.Periode)").value;
                                let Quarel = document.getElementById("QAl@(item.ID)@(Rnd)@(item.Periode)").value;

                                if (Kategori != "" && Descrip != "" && Budged != "" && Payout != "" && Quarel != "") {
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").removeClass("hm-rab-status-yellow");
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").removeAttr("data-status");
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").text("Saved");
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").attr("data-status", "Saved");
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").addClass("hm-rab-status-green");
                                    $("#Status@(item.ID)@(Rnd)@(item.Periode)").css("cursor", "default");
                                }
                            });
                        </script>
                    </div>
                    <script>
                        $(document).ready(function () {
                            let Rnd = "@(item.Round)";
                            let Round = Rnd.replace("Round ", "");
                            let Periode = "@(item.Periode)";
                            let BtnSubmit = document.querySelector("button");
                            BtnSubmit.setAttribute("id", "Submit" + Round + Periode);
                            BtnSubmit.setAttribute("data-round", Round);
                            BtnSubmit.setAttribute("data-periode", Periode);
                            BtnSubmit.setAttribute("onclick", "SubmitRAB(this)");
                        });
                    </script>
                }
            </div>
        </div>
        <div class="hm-row hm-attnt-rab"><h3>Maaf Data ini hanya dapat di tampilkan dalam layar lanscape atau desktop</h3></div>
        <div class="hm-row hm-rab-btn">
            <button>Submit</button>
        </div>
    </div>
</div>
<script src="~/Scripts/RABProccess.js"></script>
