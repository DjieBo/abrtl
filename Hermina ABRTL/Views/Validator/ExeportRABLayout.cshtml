@model Hermina_ABRTL.ViewModel.ExtReportRABVM 

<div class="hm-layout screen-page">
    <div class="hm-row hm-rab-layout ">
        <div class="hm-row hm-nav-back hm-lh-back">
            <span class="backtoForm" onclick="BacktoReportRAB('@Model.Periode')"><i class="fas fa-chevron-left"></i> Back to previous page</span>
            <div class="VisibleRound StatusAppValidator" data-status1="@Model.Approve1" data-status2="@Model.Approve2" data-status3="@Model.Approve3" data-onlog="@Model.UserOnLogin"></div>
        </div>
        <div class="hm-expport">
            <h3>Executive Report RAB @Model.NamaRS @Model.Round <span id="PeriodeValidatorRAB">@Model.Periode</span></h3>
            <div class="hm-expport-main" style="border:none">
                <div class="hm-row hm-rabform">
                    <div class="hm-row hm-rab-head">
                        <div class="hm-rab-col-3 hm-rab-head-style hm-view-fct-1">Penilaian</div>
                        <div class="hm-rab-col-4 hm-rab-head-style">Nilai</div>
                        <div class="hm-rab-col-5 hm-rab-head-style hm-view-fct-2">Keterangan</div>
                        <div class="hm-rab-col-14 hm-rab-merge-style">
                            <div class="hm-row">Material</div>
                            <div class="hm-row hm-rab-snd-row">
                                <div class="hm-subcol">Kategori</div>
                                <div class="hm-subcol hm-subcol-mid-style">Item</div>
                                <div class="hm-subcol">Merk</div>
                            </div>
                        </div>
                        <div class="hm-rab-col-6 hm-rab-merge-style">Batasan<br>Biaya</div>
                        <div class="hm-rab-col-7 hm-rab-head-style">Biaya</div>
                        <div class="hm-rab-col-8 hm-rab-head-style">Selisih</div>
                        <div class="hm-rab-col-9 hm-rab-merge-style">Picture<br>(Before)</div>
                    </div>
                    <div class="hm-row hm-rab-body">
                        @foreach (var item in Model.listData)
                        {
                            var LgKom = item.Penilaian.Length;
                            var LgInfo = item.Keterangan.Length;
                            var LgItem = item.ItemPerbaiki.Length;
                            var lgDeskrp = item.DeskripsiPerbaiki.Length;
                            var node = " ...";
                            <div class="hm-rab-list">
                                <div class="hm-rab-col-3 hm-rab-body-style hm-rab-font-style hm-view-fct-1">
                                    @if (LgKom < 35)
                                    {
                                        <div class="toltip">
                                            @item.Penilaian
                                            <span class="toltiptext">@item.SubArea / @item.Item / @item.Penilaian</span>
                                        </div>
                                    }
                                    else if (LgKom >= 35)
                                    {
                                        var SbKom = item.Penilaian.Substring(0, 35);
                                        <div class="toltip">
                                            @SbKom @node
                                            <span class="toltiptext">@item.SubArea / @item.Item / @item.Penilaian</span>
                                        </div>

                                    }
                                </div>
                                <div class="hm-rab-col-4 hm-rab-body-style hm-rab-alg-center hm-rab-font-style">@item.Nilai</div>
                                <div class="hm-rab-col-5 hm-rab-body-style hm-rab-font-style hm-view-fct-2">
                                    @if (LgInfo < 25)
                                    {@item.Keterangan }
                                else if (LgInfo >= 25)
                                {
                                    var SbInfo = item.Keterangan.Substring(0, 25); @SbInfo @node}
                                </div>
                                <div class="hm-rab-col-15 hm-rab-sel-style">

                                    <label>@item.KomponenPerbaiki</label>
                                </div>
                                <div class="hm-rab-col-15 hm-rab-sel-style">
                                    @if (LgItem < 20)
                                    {<label>@item.ItemPerbaiki</label>}
                                else
                                {
                                    var SbItem = item.ItemPerbaiki.Substring(0, 20); <label>@SbItem @node</label>}
                                </div>

                                <div class="hm-rab-col-15 hm-rab-sel-style">
                                    @if (lgDeskrp < 20)
                                    {<label>@item.DeskripsiPerbaiki</label>}
                                else
                                {
                                    var SbDeskp = item.DeskripsiPerbaiki.Substring(0, 20); <label>@SbDeskp @node</label>}
                                </div>
                                <div class="hm-rab-col-6 hm-rab-input-style hm-rab-alg-right">
                                    <input type="text" name="budget[]" value="@item.HargaDasar" disabled />
                                </div>
                                <div class="hm-rab-col-7 hm-rab-input-style" id="pyt2">
                                    <input type="text" name="payout[]" value="@item.HargaInput" autocomplete="off" disabled />
                                </div>
                                <div class="hm-rab-col-8 hm-rab-input-style hm-rab-alg-right" id="qrl2">

                                    <input type="text" name="quareel[]" value="@item.SelisihHarga" disabled>
                                </div>
                                <div class="hm-rab-col-9 hm-rab-symbol-style hm-rab-alg-center"><a href="@Url.Action("BRABImage", "Validator", new { ID = item.ID, Round = item.Round, Periode = item.Periode, IDRS = Model.IDRS})" target="_blank"><i class="fas fa-image"></i></a></div>
                            </div>
                        }
                    </div>
                </div>
            </div>
            <div class="hm-footer-row">
                <div class="hm-footer-sign">
                    <div class="hm-footer-sign-layout">
                        <div class="hm-col-sign-left">
                            <p><b>Dibuat Oleh</b></p>
                            <p>Manager JangUm @Model.NamaRS</p>
                            <p class="sign-style">
                                <span>Approved</span>
                            </p>
                            <p>@Model.Checker</p>
                        </div>
                    </div>
                    <div class="hm-footer-sign-layout">
                        <div class="hm-col-sign-right">
                            <p><b>Diperiksa Oleh</b></p>
                            <p>Wadir-Um @Model.NamaRS</p>
                            <p class="sign-style">
                                <span>Approved</span>
                            </p>
                            <p>@Model.WakilDir</p>
                        </div>
                    </div>
                </div>
                <div class="hm-footer-sign">
                    <div class="hm-footer-sign-bottom-left">
                        <p><b>Disetujui Oleh</b></p>
                        <p>Direktur @Model.NamaRS</p>
                        <p class="sign-style">
                            <span>Approved</span>   
                        </p>
                        <p>@Model.Direktur</p>
                    </div>
                    <div class="hm-footer-sign-bottom-right">
                        <p style="text-align:center;"><b>Diketahui oleh,</b></p>
                        <div class="hm-sign-bottom-child bottom-child-left">
                            <p>Kepala Departemen Penunjang Umum</p>
                            <p class="sign-style">
                                @if (Model.Approve1 != "")
                                {
                                    <span>Approved</span>
                                }
                            </p>
                            <p>@Model.Validator1</p>
                        </div>
                        <div class="hm-sign-bottom-child bottom-child-mid">
                            <p>Direktur Regional</p>
                            <p class="sign-style">
                                @if (Model.Approve2 != "")
                                {
                                    <span>Approved</span>
                                }
                            </p>
                            <p>@Model.Validator2</p>
                        </div>
                        <div class="hm-sign-bottom-child bottom-child-right">
                            <p>Direktur Operasional</p>
                            <p class="sign-style">
                                @if (Model.Approve3 != "")
                                {
                                    <span>Approved</span>
                                }
                            </p>
                            <p>@Model.Validator3</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="hm-btn-export">
            <div class="hm-row">
                <button class="hm-accpt-btn hm-spc-btn" id="btnApprfRAB" onclick="ApproveRAB('@Model.IDRS', '@Model.Round', '@Model.Periode', '@Model.Approve1', '@Model.Approve2', '@Model.Approve3', '@Model.UserOnLogin')"> Accept </button>
                @Html.ActionLink("PrintPDF", "PrintPDFRAB", new { IDRS = Model.IDRS, Round = Model.Round, Periode = Model.Periode }, new { @class = "hm-print-btn hm-spc-btn", id = "printPDFRAB", @target = "_blank", @style = "display:none" })
                <button class="hm-print-btn hm-spc-btn" onclick="BacktoReportRAB('@Model.Periode')">Back to Report</button>
            </div>
        </div>
    </div>
</div>

<script>
    let TxtPeriode = document.getElementById("PeriodeValidatorRAB").textContent;
    let Bln = parseInt(TxtPeriode.slice(-2));
    let Thn = TxtPeriode.substring(0, 4);
    const monthNames = ["", "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    let Bulan = monthNames[Bln];
    let NmBln = Bulan + " " + Thn;
    document.getElementById("PeriodeValidatorRAB").innerHTML = NmBln;

    let arrayStatus = [];
    let StatusData = document.querySelectorAll(".StatusAppValidator");
    StatusData.forEach(m => arrayStatus.push({
        Status1: m.dataset.status1,
        Status2: m.dataset.status2,
        Status3: m.dataset.status3,
        onLogin: m.dataset.onlog
    }));
    let DatainStatus = arrayStatus.find(m => m);
    if (DatainStatus.onLogin == "Validator 1" && DatainStatus.Status1 == "Diketahui" || DatainStatus.onLogin == "Validator 2" && DatainStatus.Status2 == "Diketahui" || DatainStatus.onLogin == "Validator 3" && DatainStatus.Status3 == "Diketahui") {
        $("#btnApprfRAB").css("display", "none");
        $("#printPDFRAB").css("display", "inline-block");
        $(".backtoForm").css("visibility","hidden");
    }
    function BacktoReportRAB(periode) {
            $('ul.nav-left li').removeClass("live");
            $('#RAB').addClass("live");
            $.ajax({
                url: "/Validator/RAB",
                type: "GET",
                success: function (result) {
                    $('#VldtrLayout').html(result);
                    var monthNames = ["January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"
                    ];
                    let Yrs = periode.substring(0, 4);
                    let DateChange = monthNames[parseInt(periode.substring(6, 4) - 1)] + " " + Yrs;
                    $("#RABDateNow").text(DateChange);
                    let getField = document.querySelectorAll("#RABRnd");
                    for (let i = 0; i < getField.length; i++) {
                        getField[i].setAttribute("data-periode", periode);
                    }
                    let SelectOption = document.querySelector("#RABSelectPeriode option[value='']");
                    SelectOption.setAttribute("value", periode);
                    SelectOption.innerHTML = DateChange;
                }
            });
        }
</script>